<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- a materiali bootstrap style theme -->
    <link href="https://bootswatch.com/paper/bootstrap.min.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <!-- some very simple custom styles -->
    <link href="style/parliament.css" rel="stylesheet">
    <link rel="apple-touch-icon" sizes="152x152" href="img/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="img/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="img/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="img/favicons/manifest.json">
    <link rel="mask-icon" href="img/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#fdb813">
  </head>
  <body>
    <div class="container">

      <div class="git-hub">
        <a href="https://github.com/RyanThomasMusser/facebookGroupVisualization" target="_blank">
          <button type="button" class="btn btn-xs btn-default">
            <span class="fa fa-github"></span> View on GitHub
          </button>
        </a>
      </div>

      <!-- NOTES -->
      <div class="body-well">

        <div id="loading-container" class="loading-container">
          <!-- <div id="loading-gif">
            <img src="img/dancing_owl.gif"/>
          </div> -->
          <h3>Visualizing A Facebook Group</h3>
          <br/>
          <p class="lead">
            I pulled four years worth of data from a Facebook
             group via
             <a href="https://developers.facebook.com/docs/graph-api" target="_blank">Facebook's API</a>
          <p/>
          <p class="lead">
             The group yielded 35mb+ of data, including 625k+ commented words
           </p>
           <p class="lead">
             I used <a href="https://d3js.org/" target="_blank">d3.js</a>,
             <a href="https://plot.ly/javascript/" target="_blank">plotly</a>,
             and <a href="http://www.alchemyapi.com/products/alchemylanguage/sentiment-analysis" target="_blank">sentiment analysis</a>
             to harvest the data
           </p>
          <p>
            <button class="btn btn-primary btn-lg void disabled" id="check-it-out-button">
              Just a sec
              <i class="fa fa-cog fa-spin"></i>
            </button>
          </p>
        </div>

        <div id="content-container" class="content-container">
          <div class="body-nav-container">
            <ul class="nav nav-tabs">
              <li class="active nav-tab"><a href="#group" data-toggle="tab">Group Overview</a></li>
              <li class="dropdown nav-tab">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                  View Individual User Data<span class="caret"></span>
                </a>
                <ul id="user-list" class="dropdown-menu">
                </ul>
              </li>
              <li class="nav-tab"><a href="#about" data-toggle="tab">About This Project</a></li>
            </ul>
          </div>
          <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade active in group" id="group">
              <h5 class="text-primary">A 3D Graph of Contribution and Engagement</h5>
              <div id="group-graph"></div>
              <span class="text-primary">Click and drag the graph to rotate in 3 dimensions. Scroll in the graph to zoom.</span>
              <div id="gradient"></div>
              <div class="gradient-legend">
                <div class="pull-right">More Words Per Like</div>
                <div class="pull-left">Less Words Per Like</div>
              </div>
              <div id="chord">
                <h5 class="text-primary">Mapped User Interactions</h5>
                <span class="text-primary">Hover over a single user to view their specific map.</span>
              </div>
            </div>
            <div class="tab-pane user" id="user">

              <div id="current-user-container">
                <h3 id="current-user-name"></h3>
                <span id="current-user-words" class="label label-primary current-user"></span>
                <span id="current-user-posts" class="label label-primary current-user"></span>
                <span id="current-user-likes" class="label label-primary current-user"></span>
                <span id="current-user-words-per-like" class="label label-primary current-user"></span>
              </div>

              <h5 class="text-primary">Day/Hour Heatmap of Posts Contributed</h5>
              <div id="chart"></div>
              <h5 class="text-primary">Visualization of Commonly Used Terms</h5>
              <div id="bubble"></div>
            </div>
            <div class="tab-pane fade" id="about">
              <br/>
              <h4>Group Context</h4>
              <br/>
              <p class="lead">Obviously, I've replaced the users' real names with placeholders to protect their privacy. For reference, however, <b>I am User #6</b>.</p>
              <p class="lead">This data paints a very unfortunate picture for User #7 - and as you may be able to tell from the data - User #7 is the heel of the group.</p>
              <p class="lead">The group is, generally, a sports related discussion forum. Should you be interested in more infomation on the group itself, see the public <a href="https://twitter.com/parliamentweets" target="_blank">Twitter page</a>.</p>
              <div class="center-image">
                <img src="img/parliament.jpg"/>
              </div>
              <hr/>
              <h4>Technical Tools and Considerations</h4>
              <br/>
              <p class="lead">I spent roughly 10-15 hours on this project; I had a ton of fun.</p>
              <p class="lead">I used, and made a PR for, the <a href="https://github.com/KyleAMathews/facebook-export" target="_blank">KyleAMathews/facebook-export</a>
                repository to retrieve the data from the Facebook group.</p>
              <p class="lead">
                To visually display the data, I used <a href="https://d3js.org/" target="_blank">d3.js</a> for the user pages and
                <a href="https://plot.ly/javascript/" target="_blank">plotly</a> for the 3D group chart.
                I plan on using <a href="http://www.alchemyapi.com/products/alchemylanguage/sentiment-analysis" target="_blank">alchemy</a> for deeper sentiment analysis and NLP.
              </p>
              <p class="lead">
                 The group yielded 35mb+ of data, including 625k+ commented words. Obviously, you don't want to process the entirety of this data within the DOM.
                 I built an engine to distill these large data dumps into usable chunks; if you're interested in reviewing that,
                 please check my <a href="https://github.com/RyanThomasMusser/facebookGroupVisualization" target="_blank">Github repository</a>.
              </p>
            </div>
          </div>
        </div>

      </div>
      <!-- /NOTES -->


    </div>

    <!-- jQuery and Bootstrap's JavaScript-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>

    <script src="js/parliament.js"></script>
    <script>

      //instantiate the app
      var parliament = parliamentApp()

      $( document ).ready(function() {

        $( 'body' ).animate({opacity: 1},1000,function(){
          //initialize the app
          parliament.initialize(userObject)

          //try to do some adjusting for mobile
          $('#group-graph').bind( "touchstart", function(e){
            $('#group-graph').mousedown()
          });

          var matrix = parliament.fetchMatrix()
          var users = parliament.fetchChords()

          drawChords(users,matrix)

        })

        //
        //
        function drawChords(users,matrix){

          var width = 500,
              height = 500,
              outerRadius = Math.min(width, height) / 2 - 10,
              innerRadius = outerRadius - 24;

          var arc = d3.svg.arc()
              .innerRadius(innerRadius)
              .outerRadius(outerRadius);

          var layout = d3.layout.chord()
              .padding(.04)
              .sortSubgroups(d3.descending)
              .sortChords(d3.ascending);

          var path = d3.svg.chord()
              .radius(innerRadius);

          var svg = d3.select("#chord").append("svg")
              .attr("width", width)
              .attr("height", height)
            .append("g")
              .attr("id", "chordCircle")
              .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

          svg.append("circle")
              .attr("r", outerRadius);

          // Compute the chord layout.
          layout.matrix(matrix);

          // Add a group per neighborhood.
          var group = svg.selectAll(".group")
              .data(layout.groups)
            .enter().append("g")
              .attr("class", "group")
              .on("mouseover", mouseover);

          // Add a mouseover title.
          group.append("title").text(function(d, i) {
            return users[i].name;
          });

          // Add the group arc.
          var groupPath = group.append("path")
              .attr("id", function(d, i) { return "group" + i; })
              .attr("d", arc)
              .style("fill", function(d, i) { return users[i].color; });

          // Add a text label.
          var groupText = group.append("text")
              .attr("x", 6)
              .attr("dy", 15);

          groupText.append("textPath")
              .attr("xlink:href", function(d, i) { return "#group" + i; })
              .text(function(d, i) { return users[i].name; });

          // Remove the labels that don't fit. :(
          groupText.filter(function(d, i) { return groupPath[0][i].getTotalLength() / 2 - 16 < 46; })
              .remove();


          // Add the chords.
          var chord = svg.selectAll(".chord")
              .data(layout.chords)
            .enter().append("path")
              .attr("class", "chord")
              .style("fill", function(d) { return users[d.source.index].color; })
              .attr("d", path);

          // Add an elaborate mouseover title for each chord.
          chord.append("title").text(function(d) {
            return users[d.source.index].name
                + " → " + users[d.target.index].name
                + ": " + d.source.value
                + "\n" + users[d.target.index].name
                + " → " + users[d.source.index].name
                + ": " + d.target.value;
          });

          function mouseover(d, i) {
            chord.classed("fade", function(p) {
              return p.source.index != i
                  && p.target.index != i;
            });
          }

        }
        //
        //

      });

    </script>



    <script src="lib/output/refined_output.json"></script>
  </body>
</html>
